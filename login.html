<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login - Casamento Perfeito</title>
  <link rel="icon" href="assets/img/iconsite.png" type="image/x-icon">
  <link rel="stylesheet" href="assets/css/login.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ledger&display=swap" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
  <script src="api.js"></script>
</head>

<body>
    <main>
      <div class="principal">
        <div class="formulario">
        <h1 class="titulo">Login</h1>
        <img src="assets/img/logo-preta.png" alt="Logo Casamento Perfeito" class="logo-canto">
        <input name="email" id="email" type="email" placeholder="E-mail" required />
        <input name="senha" id="senha" type="password" placeholder="Senha" required />
        <button type="submit" class="botao-login">Entrar</button>
        <p class="cadastro">Não possui uma conta? <a class="cadastro" href="cadastro.html">Cadastre-se</a></p>
        </div>
    </main>
</body>
<script>
  $("#senha").after('<img class=toggleSenha id="toggleSenha" src="https://cdn-icons-png.flaticon.com/512/2767/2767146.png" style="width:20px; cursor:pointer; position:absolute; left:770px; top:265px;">');

        $("#toggleSenha").on("click", function () {
            let senhaInput = $("#senha");
            let icone = $("#toggleSenha");

            if (senhaInput.attr("type") === "password") {
                senhaInput.attr("type", "text");
                icone.attr("src", "https://cdn-icons-png.flaticon.com/512/2767/2767149.png");
            } else {
                senhaInput.attr("type", "password");
                icone.attr("src", "https://cdn-icons-png.flaticon.com/512/2767/2767146.png");
            }
        });

</script>
<script>
$(document).ready(function() {

    $(".botao-login").on("click", function(e) {
        e.preventDefault();

        let email = $("#email").val().trim();
        let senha = $("#senha").val().trim();

        if (!email || !senha) {
            Swal.fire({
                title: "Erro!",
                text: "Por favor, preencha todos os campos!",
                icon: "error"
            });
            return;
        }
        let dados = JSON.stringify({ email, senha });

        $.ajax({
            method: "POST",
            url: "http://10.92.3.202:5000/login",
            contentType: "application/json",
            data: dados,
            success: function(retorno) {
                console.log("Resposta do servidor:", retorno); 

                let usuario = retorno.usuarios || retorno.user || retorno; 

                if (!usuario || !usuario.token) {
                    Swal.fire({
                        title: "Erro!",
                        text: "Não foi possível recuperar os dados do usuário.",
                        icon: "error"
                    });
                    return;
                }

                localStorage.setItem("token", usuario.token || "");
                localStorage.setItem("nome", usuario.nome || "");
                localStorage.setItem("email", usuario.email || "");
                localStorage.setItem("telefone", usuario.telefone || "");
                localStorage.setItem("id_cadastro", usuario.id_cadastro || "");
                localStorage.setItem("tipo", usuario.tipo || "");

                Swal.fire({
                    title: "Login bem-sucedido!",
                    icon: "success"
                }).then(() => {
                    if (usuario.tipo === "adm") {
                        window.location.href = "homeeae.html";
                    } else {
                        window.location.href = "homePoslogin.html";
                    }
                });
            },
            error: function(retorno) {
                console.log("Erro na requisição:", retorno);
                Swal.fire({
                    title: "Erro!",
                    text: retorno.responseJSON?.error || "Erro ao tentar fazer login.",
                    icon: "error"
                });
            }
        });

    });

});
</script>


</html>
